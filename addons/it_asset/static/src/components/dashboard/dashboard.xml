<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="it_asset.DashboardMain">
        <div class="o_action_manager o_content o_it_asset_dashboard scroll-y">
            
            <!-- Standard Odoo-Style Control Panel -->
            <div class="control-panel shadow-sm">
                <div class="cp-left">
                    <div class="cp-title" t-esc="'IT Dashboard Overview'"/>
                </div>
                <div class="cp-right">
                    <!-- Filter Toggle (Desktop & Mobile) -->
                    <button class="btn btn-light border shadow-sm rounded-3 filter-toggle-btn"
                            t-on-click="() => this.state.showMobileFilters = !this.state.showMobileFilters">
                        <i t-attf-class="fa {{ state.showMobileFilters ? 'fa-times' : 'fa-filter' }} me-2 text-primary"></i>
                        <span t-esc="state.showMobileFilters ? 'Close' : 'Filters'"/>
                    </button>

                    <div t-attf-class="filters-container {{ state.showMobileFilters ? 'mobile-show' : '' }}">
                        <!-- Category Filter -->
                        <div class="filter-group dropdown">
                            <div class="dropdown-toggle d-flex align-items-center cursor-pointer" data-bs-toggle="dropdown" aria-expanded="false">
                                <label><i class="fa fa-tag"></i>Category</label>
                                <span class="ms-2 selected-text" t-esc="selectedCategoriesNames"/>
                            </div>
                            <ul class="dropdown-menu shadow-lg border-0 mt-2 py-1">
                                <!-- All Categories Option -->
                                <li class="px-0">
                                    <div t-attf-class="dropdown-item d-flex align-items-center px-3 py-2 cursor-pointer {{selectedCategories.length === 0 ? 'selected-item' : ''}}" 
                                         t-on-click.stop="() => this.toggleCategory(null)">
                                        <div class="o_checkbox me-3">
                                            <input type="checkbox" class="form-check-input" t-att-checked="selectedCategories.length === 0"/>
                                            <span/>
                                        </div>
                                        <span class="fw-bold">All Categories</span>
                                    </div>
                                </li>
                                
                                <li><hr class="dropdown-divider mx-3 opacity-50"/></li>
                                
                                <!-- Dynamic Categories -->
                                <t t-foreach="categories" t-as="cat" t-key="cat.id">
                                    <li class="px-0">
                                        <div t-attf-class="dropdown-item d-flex align-items-center px-3 py-2 cursor-pointer {{selectedCategories.includes(cat.id) ? 'selected-item' : ''}}" 
                                             t-on-click.stop="() => this.toggleCategory(cat.id)">
                                            <div class="o_checkbox me-3">
                                                <input type="checkbox" class="form-input-check" t-att-checked="selectedCategories.includes(cat.id)"/>
                                                <span/>
                                            </div>
                                            <span t-esc="cat.name"/>
                                        </div>
                                    </li>
                                </t>
                            </ul>
                        </div>
                        
                        <!-- Date Filters -->
                        <div class="filter-group">
                            <label><i class="fa fa-calendar-check-o"></i>From</label>
                            <input type="date" t-on-change="(ev) => this.onDateChange('start', ev)" t-att-value="dateStart"/>
                        </div>
                        <div class="filter-group">
                            <label><i class="fa fa-calendar-times-o"></i>To</label>
                            <input type="date" t-on-change="(ev) => this.onDateChange('end', ev)" t-att-value="dateEnd"/>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-content">
                
                <!-- Summary Section -->
                <div class="section-header">INVENTORY STATUS</div>
                <div class="row g-3 mb-4">
                    <!-- IT Assets -->
                    <div class="col-6 col-md-4 col-xl">
                        <div class="modern-card card-purple" t-on-click="() => this.openView('all')">
                            <div class="card-body">
                                <div class="icon-circle shadow-sm"><i class="fa fa-laptop"></i></div>
                                <div class="stat-label">IT Assets</div>
                                <div class="stat-value" t-esc="stats.total_it"/>
                            </div>
                        </div>
                    </div>
                    <!-- Available -->
                    <div class="col-6 col-md-4 col-xl">
                        <div class="modern-card card-green" t-on-click="() => this.openView('available')">
                            <div class="card-body">
                                <div class="icon-circle shadow-sm"><i class="fa fa-check-circle"></i></div>
                                <div class="stat-label">Available</div>
                                <div class="stat-value" t-esc="stats.available"/>
                            </div>
                        </div>
                    </div>
                    <!-- In Use -->
                    <div class="col-6 col-md-4 col-xl">
                        <div class="modern-card card-blue" t-on-click="() => this.openView('in_use')">
                            <div class="card-body">
                                <div class="icon-circle shadow-sm"><i class="fa fa-user"></i></div>
                                <div class="stat-label">In Use</div>
                                <div class="stat-value" t-esc="stats.assigned"/>
                            </div>
                        </div>
                    </div>
                    <!-- Unavailable -->
                    <div class="col-6 col-md-4 col-xl">
                        <div class="modern-card card-red" t-on-click="() => this.openView('unavailable')">
                            <div class="card-body">
                                <div class="icon-circle shadow-sm"><i class="fa fa-ban text-danger"></i></div>
                                <div class="stat-label">Unavailable</div>
                                <div class="stat-value" t-esc="stats.unavailable_broken"/>
                            </div>
                        </div>
                    </div>
                    <!-- Maintenance -->
                    <div class="col-6 col-md-4 col-xl">
                        <div class="modern-card card-amber" t-on-click="() => this.openView('maintenance_logs')">
                            <div class="card-body">
                                <div class="icon-circle shadow-sm"><i class="fa fa-wrench"></i></div>
                                <div class="stat-label">Maintenance</div>
                                <div class="stat-value" t-esc="stats.maintenance_count"/>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row g-4 mb-4">
                    <!-- Laptop Condition Column Chart (25%) -->
                    <div class="col-12 col-lg-3">
                        <div class="chart-panel shadow-sm">
                            <div class="d-flex justify-content-between align-items-start mb-4">
                                <h4 class="mb-0 text-truncate">Laptop Condition</h4>
                                <div class="badge-total shadow-sm px-2 py-1 rounded-3 bg-light border d-flex align-items-center">
                                    <i class="fa fa-laptop me-2 text-primary small"></i>
                                    <span class="fw-bold text-primary" t-esc="stats.laptop_condition_distribution.total"/>
                                </div>
                            </div>
                            
                            <div class="d-flex align-items-end justify-content-around h-75 mt-4">
                                <t t-foreach="stats.laptop_condition_distribution.data" t-as="cond" t-key="cond.label">
                                    <div class="d-flex flex-column align-items-center flex-grow-1">
                                        <div class="fw-bold mb-2 small" t-esc="cond.count"/>
                                        <div class="column-bar shadow-sm"
                                             t-attf-style="height: {{ cond.perc }}px; background-color: {{ cond.color }}; width: 40px; border-radius: 4px 4px 0 0; transition: height 1s ease-out;"/>
                                        <div class="mt-2 small text-muted text-center" style="font-size: 0.65rem;" t-esc="cond.label"/>
                                    </div>
                                </t>
                            </div>
                            <t t-if="!stats.laptop_condition_distribution.data or !stats.laptop_condition_distribution.data.length">
                                <div class="text-center py-4">
                                    <span class="small text-muted">No Laptop found</span>
                                </div>
                            </t>
                        </div>
                    </div>

                    <!-- Asset Category Column Chart (45%) -->
                    <div class="col-12 col-lg-5">
                        <div class="chart-panel shadow-sm">
                            <h4 class="mb-4">Asset Category</h4>
                            <div class="d-flex align-items-end justify-content-around h-75 mt-4">
                                <t t-foreach="stats.category_distribution" t-as="cat_data" t-key="cat_data.name">
                                    <div class="d-flex flex-column align-items-center flex-grow-1 px-1">
                                        <div class="fw-bold mb-2 small text-primary" t-esc="cat_data.count"/>
                                        <div class="column-bar shadow-sm"
                                             t-attf-style="height: {{ (cat_data.count / (stats.total_it or 1)) * 200 }}px; background: linear-gradient(180deg, #6366f1 0%, #a855f7 100%); width: 20px; border-radius: 4px 4px 0 0; transition: height 1s ease-out;"/>
                                        <div class="mt-2 small text-muted text-center text-truncate w-100" style="font-size: 0.6rem;" t-esc="cat_data.name"/>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>

                    <!-- Status Map (30%) -->
                    <div class="col-12 col-lg-4">
                        <div class="chart-panel shadow-sm">
                            <h4 class="mb-4">Radio Status</h4>
                            <div class="donut-wrapper mb-4 shadow-sm" 
                                 t-attf-style="background: conic-gradient(
                                    #16a34a 0% {{ (stats.op_available / (stats.total_operation or 1)) * 100 }}%, 
                                    #0284c7 {{ (stats.op_available / (stats.total_operation or 1)) * 100 }}% {{ ((stats.op_available + stats.op_assigned) / (stats.total_operation or 1)) * 100 }}%, 
                                    #f59e0b {{ ((stats.op_available + stats.op_assigned) / (stats.total_operation or 1)) * 100 }}% {{ ((stats.op_available + stats.op_assigned + stats.op_maintenance) / (stats.total_operation or 1)) * 100 }}%,
                                    #ef4444 {{ ((stats.op_available + stats.op_assigned + stats.op_maintenance) / (stats.total_operation or 1)) * 100 }}% 100%
                                 );">
                                <div class="donut-hole shadow-inner">
                                    <span class="hole-value" t-esc="stats.total_operation"/>
                                    <span class="hole-label">Radios</span>
                                </div>
                            </div>
                            <!-- Legend -->
                                <div class="d-flex align-items-center justify-content-between small fw-bold">
                                    <span class="text-muted"><i class="fa fa-circle me-2 text-success"></i>Available</span>
                                    <span t-esc="stats.op_available"/>
                                </div>
                                <div class="d-flex align-items-center justify-content-between small fw-bold">
                                    <span class="text-muted"><i class="fa fa-circle me-2 text-primary"></i>In Use</span>
                                    <span t-esc="stats.op_assigned"/>
                                </div>
                                <div class="d-flex align-items-center justify-content-between small fw-bold">
                                    <span class="text-muted"><i class="fa fa-circle me-2 text-warning"></i>Maintenance</span>
                                    <span t-esc="stats.op_maintenance"/>
                                </div>
                                <div class="d-flex align-items-center justify-content-between small fw-bold">
                                    <span class="text-muted"><i class="fa fa-circle me-2 text-danger"></i>Unavailable</span>
                                    <span t-esc="stats.op_unavailable_broken"/>
                                </div>
                        </div>
                    </div>
                </div>

                <!-- Comparison & Printer Section -->
                <div class="row g-4 mb-4">
                    <!-- Fleet vs Radio (70%) -->
                    <div class="col-12 col-lg-8">
                        <div class="chart-panel shadow-sm h-100 mb-0">
                            <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
                                <h4 class="mb-0">Fleet vs Radio</h4>
                                
                                <div class="d-flex gap-2">
                                    <!-- Asset Category Filter -->
                                    <div class="dropdown">
                                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                            Asset Category
                                        </button>
                                        <ul class="dropdown-menu shadow">
                                            <li class="px-2 py-1">
                                                <div class="dropdown-item d-flex align-items-center cursor-pointer" 
                                                     t-attf-class="{{selectedAssetCategories.length === 0 ? 'selected-item' : ''}}"
                                                     t-on-click.stop="() => this.toggleAssetCategory(null)">
                                                    <div class="o_checkbox me-2">
                                                        <input type="checkbox" class="form-check-input" t-att-checked="selectedAssetCategories.length === 0"/>
                                                        <span/>
                                                    </div>
                                                    <span>All Radio</span>
                                                </div>
                                            </li>
                                            <li><hr class="dropdown-divider"/></li>
                                            <t t-foreach="assetCategories" t-as="ac" t-key="ac.id">
                                                <li class="px-2 py-1">
                                                    <div class="dropdown-item d-flex align-items-center cursor-pointer" 
                                                         t-attf-class="{{selectedAssetCategories.includes(ac.id) ? 'selected-item' : ''}}"
                                                         t-on-click.stop="() => this.toggleAssetCategory(ac.id)">
                                                        <div class="o_checkbox me-2">
                                                            <input type="checkbox" class="form-check-input" t-att-checked="selectedAssetCategories.includes(ac.id)"/>
                                                            <span/>
                                                        </div>
                                                        <span t-esc="ac.name"/>
                                                    </div>
                                                </li>
                                            </t>
                                        </ul>
                                    </div>

                                    <!-- Fleet Category Filter -->
                                    <div class="dropdown">
                                        <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                            Fleet Category
                                        </button>
                                        <ul class="dropdown-menu shadow">
                                            <li class="px-2 py-1">
                                                <div class="dropdown-item d-flex align-items-center cursor-pointer" 
                                                     t-attf-class="{{selectedFleetCategories.length === 0 ? 'selected-item' : ''}}"
                                                     t-on-click.stop="() => this.toggleFleetCategory(null)">
                                                    <div class="o_checkbox me-2">
                                                        <input type="checkbox" class="form-check-input" t-att-checked="selectedFleetCategories.length === 0"/>
                                                        <span/>
                                                    </div>
                                                    <span>All Fleets</span>
                                                </div>
                                            </li>
                                            <li><hr class="dropdown-divider"/></li>
                                            <t t-foreach="fleetCategories" t-as="fc" t-key="fc.id">
                                                <li class="px-2 py-1">
                                                    <div class="dropdown-item d-flex align-items-center cursor-pointer" 
                                                         t-attf-class="{{selectedFleetCategories.includes(fc.id) ? 'selected-item' : ''}}"
                                                         t-on-click.stop="() => this.toggleFleetCategory(fc.id)">
                                                        <div class="o_checkbox me-2">
                                                            <input type="checkbox" class="form-check-input" t-att-checked="selectedFleetCategories.includes(fc.id)"/>
                                                            <span/>
                                                        </div>
                                                        <span t-esc="fc.name"/>
                                                    </div>
                                                </li>
                                            </t>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="row align-items-center">
                                <div class="col-md-12">
                                    <div class="comparison-bar-container">
                                        <!-- Top Info Labels -->
                                        <div class="d-flex justify-content-between mb-2 small fw-bold">
                                            <span class="text-primary"><i class="fa fa-car me-1"></i> Fleet Units (<t t-esc="stats.fleet_comparison.units"/>)</span>
                                            <span class="text-purple"><i class="fa fa-rss me-1"></i> Radio Device (<t t-esc="stats.fleet_comparison.assets"/>)</span>
                                        </div>
                                        
                                        <!-- Modern Comparison Progress Bar -->
                                        <div class="progress shadow-sm mb-3" style="height: 24px; border-radius: 12px; background-color: #f1f5f9; overflow: visible; position: relative;">
                                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                                 role="progressbar" 
                                                 t-attf-style="width: {{ Math.min(stats.fleet_comparison.ratio, 100) }}%; background: linear-gradient(90deg, #6366f1 0%, #a855f7 100%); border-radius: 12px; transition: width 1.5s cubic-bezier(0.34, 1.56, 0.64, 1);">
                                            </div>
                                            <div t-if="stats.fleet_comparison.ratio > 100" 
                                                 class="position-absolute end-0 top-0 mt-n4 me-2 text-danger fw-bold pulse-animation" 
                                                 style="font-size: 0.65rem;">
                                                <i class="fa fa-warning"></i> OVER-EQUIPPED
                                            </div>
                                        </div>

                                        <div class="d-flex justify-content-between align-items-center pt-2 border-top">
                                            <div>
                                                <span class="small text-muted uppercase">Coverage: </span>
                                                <span class="h5 mb-0 fw-black ms-1" t-attf-class="{{ stats.fleet_comparison.ratio >= 100 ? 'text-success' : (stats.fleet_comparison.ratio > 70 ? 'text-primary' : 'text-warning') }}">
                                                    <t t-esc="stats.fleet_comparison.ratio.toFixed(1)"/>%
                                                </span>
                                            </div>
                                            <div class="micro-text text-muted">
                                                <t t-if="stats.fleet_comparison.ratio >= 100">Full Coverage achieved.</t>
                                                <t t-else="">Shortage: <t t-esc="stats.fleet_comparison.units - stats.fleet_comparison.assets"/> devices.</t>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Printer Usage (30%) -->
                    <div class="col-12 col-lg-4">
                        <div class="chart-panel shadow-sm h-100 mb-0 d-flex flex-column">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4 class="mb-0">Printer Usage</h4>
                                <!-- Printer Period Filter -->
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-light border py-1 px-3 fw-bold micro-text shadow-sm dropdown-toggle rounded-pill text-purple" type="button" data-bs-toggle="dropdown">
                                        <t t-esc="state.printerPeriod"/>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end shadow border-0">
                                        <li><a class="dropdown-item micro-text fw-bold" href="#" t-on-click.prevent="() => this.setPrinterPeriod('7D')">7D (Last Week)</a></li>
                                        <li><a class="dropdown-item micro-text fw-bold" href="#" t-on-click.prevent="() => this.setPrinterPeriod('1M')">1M (Last Month)</a></li>
                                        <li><a class="dropdown-item micro-text fw-bold" href="#" t-on-click.prevent="() => this.setPrinterPeriod('1Y')">1Y (Last Year)</a></li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="flex-grow-1 d-flex flex-column justify-content-between">
                                <div class="printer-stats-main mb-4">
                                    <div class="d-flex align-items-end gap-2 mb-1">
                                        <span class="h2 mb-0 fw-black text-slate-800"><t t-esc="stats.printer_stats.total_pages.toLocaleString()"/></span>
                                        <span class="text-muted small pb-1">Total Pages</span>
                                    </div>
                                    <div class="micro-text text-success fw-bold">
                                        <i class="fa fa-caret-up"></i> <t t-esc="stats.printer_stats.recent_pages.toLocaleString()"/> printed 
                                        <t t-if="state.printerPeriod == '7D'">last week</t>
                                        <t t-elif="state.printerPeriod == '1M'">last month</t>
                                        <t t-else="">last year</t>
                                    </div>
                                </div>

                                <div class="usage-split-box mb-4">
                                    <div class="d-flex justify-content-between micro-text mb-1 fw-bold">
                                        <span class="text-muted">B/W vs COLOR</span>
                                        <span class="text-purple"><t t-esc="((stats.printer_stats.total_color / (stats.printer_stats.total_pages or 1)) * 100).toFixed(0)"/>% Color</span>
                                    </div>
                                    <div class="progress" style="height: 8px; border-radius: 4px; background: #e2e8f0;">
                                        <div class="progress-bar" role="progressbar" 
                                             t-attf-style="width: {{ (stats.printer_stats.total_bw / (stats.printer_stats.total_pages or 1)) * 100 }}%; background-color: #475569;" 
                                             t-att-aria-valuenow="stats.printer_stats.total_bw" aria-valuemin="0" t-att-aria-valuemax="stats.printer_stats.total_pages"></div>
                                        <div class="progress-bar" role="progressbar" 
                                             t-attf-style="width: {{ (stats.printer_stats.total_color / (stats.printer_stats.total_pages or 1)) * 100 }}%; background: linear-gradient(90deg, #f472b6, #a855f7);" 
                                             t-att-aria-valuenow="stats.printer_stats.total_color" aria-valuemin="0" t-att-aria-valuemax="stats.printer_stats.total_pages"></div>
                                    </div>
                                    <div class="d-flex justify-content-between mt-2">
                                        <div class="small d-flex align-items-center">
                                            <div class="rounded-circle me-1" style="width: 8px; height: 8px; background: #475569;"></div>
                                            <span class="text-muted"><t t-esc="stats.printer_stats.total_bw.toLocaleString()"/> B/W</span>
                                        </div>
                                        <div class="small d-flex align-items-center">
                                            <div class="rounded-circle me-1" style="width: 8px; height: 8px; background: #a855f7;"></div>
                                            <span class="text-muted"><t t-esc="stats.printer_stats.total_color.toLocaleString()"/> Color</span>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer Stats (Support & Recent) -->
                <div class="row g-4">
                    <div class="col-12 col-md-6">
                        <div class="chart-panel shadow-sm">
                            <h4 class="mb-3">IT Helpdesk (Upcoming)</h4>
                            <div class="row g-2">
                                <div class="col-6">
                                    <div class="p-3 bg-light rounded-3 border d-flex align-items-center">
                                        <div class="me-2 me-md-3 p-2 bg-white rounded shadow-sm d-none d-sm-block"><i class="fa fa-ticket text-primary"></i></div>
                                        <div>
                                            <div class="text-muted small fw-bold" style="font-size: 0.65rem;">ACTIVE TICKETS</div>
                                            <div class="h4 mb-0 fw-bold" t-esc="stats.tickets_open"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="p-3 bg-light rounded-3 border d-flex align-items-center">
                                        <div class="me-2 me-md-3 p-2 bg-white rounded shadow-sm d-none d-sm-block"><i class="fa fa-user-plus text-success"></i></div>
                                        <div>
                                            <div class="text-muted small fw-bold" style="font-size: 0.65rem;">ACCOUNTS REQ</div>
                                            <div class="h4 mb-0 fw-bold" t-esc="stats.account_requests_pending"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6">
                        <div class="chart-panel shadow-sm">
                            <h4 class="mb-3">Activity Log</h4>
                            <div class="activity-log">
                                <t t-foreach="stats.recent_activities" t-as="activity" t-key="activity.id">
                                    <div class="log-entry">
                                        <div class="entry-icon shadow-sm">
                                            <i t-if="activity.type == 'ticket'" class="fa fa-ticket"></i>
                                            <i t-if="activity.type == 'request'" class="fa fa-user-plus"></i>
                                            <i t-if="activity.type == 'asset'" class="fa fa-laptop"></i>
                                        </div>
                                        <div class="flex-grow-1 overflow-hidden">
                                            <div class="fw-bold small text-truncate" t-esc="activity.title"/>
                                            <div class="text-muted text-truncate" style="font-size: 0.7rem;" t-esc="activity.time"/>
                                        </div>
                                        <span t-attf-class="badge rounded-pill bg-{{activity.status === 'new' ? 'success' : (activity.status === 'pending' ? 'warning' : 'primary')}} bg-opacity-10 text-{{activity.status === 'new' ? 'success' : (activity.status === 'pending' ? 'warning' : 'primary')}} small px-2 px-md-3">
                                            <t t-esc="activity.status.toUpperCase()"/>
                                        </span>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Bottom spacing for aesthetic scroll -->
                <div style="height: 40px;"></div>
            </div>
        </div>
    </t>
</templates>
