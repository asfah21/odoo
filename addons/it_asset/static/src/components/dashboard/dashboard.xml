<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="it_asset.DashboardMain">
        <div class="o_action_manager o_content o_it_asset_dashboard scroll-y">
            
            <!-- Standard Odoo-Style Control Panel -->
            <div class="control-panel">
                <div class="cp-left">
                    <div class="cp-title">Asset Overview</div>
                </div>
                <div class="cp-right">
                    <!-- Category Filter -->
                    <div class="filter-group shadow-sm">
                        <label><i class="fa fa-tag me-1"></i>Category</label>
                        <select class="category-select" t-on-change="onFilterCategory">
                            <option value="">All Category</option>
                            <t t-foreach="categories" t-as="cat" t-key="cat.id">
                                <option t-att-value="cat.id" t-att-selected="selectedCategory === cat.id">
                                    <t t-esc="cat.name"/>
                                </option>
                            </t>
                        </select>
                    </div>
                    
                    <!-- Date Filters -->
                    <div class="filter-group shadow-sm">
                        <label><i class="fa fa-calendar me-1"></i>From</label>
                        <input type="date" t-on-change="(ev) => this.onDateChange('start', ev)" t-att-value="dateStart"/>
                    </div>
                    <div class="filter-group shadow-sm">
                        <label><i class="fa fa-calendar me-1"></i>To</label>
                        <input type="date" t-on-change="(ev) => this.onDateChange('end', ev)" t-att-value="dateEnd"/>
                    </div>
                </div>
            </div>

            <div class="dashboard-content">
                
                <!-- Summary Section -->
                <div class="section-header">INVENTORY STATUS</div>
                <div class="row g-3 mb-4">
                    <div class="col-md-3">
                        <div class="modern-card card-purple shadow-sm" t-on-click="() => this.openView('all')">
                            <div class="card-body">
                                <div class="icon-circle shadow-sm"><i class="fa fa-laptop"></i></div>
                                <div class="stat-label">Total Assets</div>
                                <div class="stat-value" t-esc="stats.total_assets"/>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="modern-card card-green shadow-sm" t-on-click="() => this.openView('available')">
                            <div class="card-body">
                                <div class="icon-circle shadow-sm"><i class="fa fa-check-circle"></i></div>
                                <div class="stat-label">Available</div>
                                <div class="stat-value" t-esc="stats.available"/>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="modern-card card-blue shadow-sm" t-on-click="() => this.openView('assigned')">
                            <div class="card-body">
                                <div class="icon-circle shadow-sm"><i class="fa fa-user"></i></div>
                                <div class="stat-label">Assigned</div>
                                <div class="stat-value" t-esc="stats.assigned"/>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="modern-card card-amber shadow-sm" t-on-click="() => this.openView('repair')">
                            <div class="card-body">
                                <div class="icon-circle shadow-sm"><i class="fa fa-wrench"></i></div>
                                <div class="stat-label">Maintenance</div>
                                <div class="stat-value" t-esc="stats.repair"/>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row g-4">
                    <!-- Distribution Chart -->
                    <div class="col-lg-4">
                        <div class="chart-panel h-100 shadow-sm">
                            <h4 class="mb-4">Status Map</h4>
                            <div class="donut-wrapper mb-4 shadow-sm rounded-circle" 
                                 t-attf-style="background: conic-gradient(
                                    #16a34a 0% {{ (stats.available / (stats.total_assets or 1)) * 100 }}%, 
                                    #0284c7 {{ (stats.available / (stats.total_assets or 1)) * 100 }}% {{ ((stats.available + stats.assigned) / (stats.total_assets or 1)) * 100 }}%, 
                                    #d97706 {{ ((stats.available + stats.assigned) / (stats.total_assets or 1)) * 100 }}% {{ ((stats.available + stats.assigned + stats.repair) / (stats.total_assets or 1)) * 100 }}%,
                                    #ef4444 {{ ((stats.available + stats.assigned + stats.repair) / (stats.total_assets or 1)) * 100 }}% 100%
                                 );">
                                <div class="donut-hole shadow-inner">
                                    <span class="hole-value" t-esc="stats.total_assets"/>
                                    <span class="hole-label">Total</span>
                                </div>
                            </div>
                            <!-- Legend -->
                            <div class="d-flex flex-column gap-2 mt-2 px-2">
                                <div class="d-flex align-items-center justify-content-between small fw-bold">
                                    <span class="text-muted"><i class="fa fa-circle me-2 text-success"></i>Available</span>
                                    <span t-esc="stats.available"/>
                                </div>
                                <div class="d-flex align-items-center justify-content-between small fw-bold">
                                    <span class="text-muted"><i class="fa fa-circle me-2 text-primary"></i>Assigned</span>
                                    <span t-esc="stats.assigned"/>
                                </div>
                                <div class="d-flex align-items-center justify-content-between small fw-bold">
                                    <span class="text-muted"><i class="fa fa-circle me-2 text-warning"></i>Repair</span>
                                    <span t-esc="stats.repair"/>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category Bar Chart -->
                    <div class="col-lg-8">
                        <div class="chart-panel h-100 shadow-sm">
                            <h4 class="mb-4">Top Asset Categories</h4>
                            <div class="category-list">
                                <t t-foreach="stats.category_distribution" t-as="cat_data" t-key="cat_data.name">
                                    <div class="category-bar-row">
                                        <div class="bar-info">
                                            <span t-esc="cat_data.name"/>
                                            <span class="text-primary" t-esc="cat_data.count"/>
                                        </div>
                                        <div class="bar-track">
                                            <div class="bar-progress" 
                                                 t-attf-style="width: {{ (cat_data.count / (stats.total_assets or 1)) * 100 }}%"/>
                                        </div>
                                    </div>
                                </t>
                                <t t-if="!stats.category_distribution.length">
                                    <div class="text-center py-5">
                                        <i class="fa fa-info-circle fa-2x text-muted mb-2"></i>
                                        <p class="text-muted">No category data found for selected period.</p>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer Stats (Support & Recent) -->
                <div class="row g-4 mt-1">
                    <div class="col-lg-6">
                        <div class="chart-panel shadow-sm">
                            <h4 class="mb-3">Global Service Stats (Upcoming)</h4>
                            <div class="row g-2">
                                <div class="col-6">
                                    <div class="p-3 bg-light rounded-3 border d-flex align-items-center">
                                        <div class="me-3 p-2 bg-white rounded shadow-sm"><i class="fa fa-ticket text-primary"></i></div>
                                        <div>
                                            <div class="text-muted small fw-bold">ACTIVE TICKETS</div>
                                            <div class="h4 mb-0 fw-bold" t-esc="stats.tickets_open"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="p-3 bg-light rounded-3 border d-flex align-items-center">
                                        <div class="me-3 p-2 bg-white rounded shadow-sm"><i class="fa fa-user-plus text-success"></i></div>
                                        <div>
                                            <div class="text-muted small fw-bold">ACCOUNTS REQ</div>
                                            <div class="h4 mb-0 fw-bold" t-esc="stats.account_requests_pending"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="chart-panel shadow-sm">
                            <h4 class="mb-3">Recent Operations</h4>
                            <div class="activity-log">
                                <t t-foreach="stats.recent_activities" t-as="activity" t-key="activity.id">
                                    <div class="log-entry">
                                        <div class="entry-icon shadow-sm">
                                            <i t-if="activity.type == 'ticket'" class="fa fa-ticket"></i>
                                            <i t-if="activity.type == 'request'" class="fa fa-user-plus"></i>
                                            <i t-if="activity.type == 'asset'" class="fa fa-laptop"></i>
                                        </div>
                                        <div class="flex-grow-1">
                                            <div class="fw-bold small" t-esc="activity.title"/>
                                            <div class="text-muted" style="font-size: 0.7rem;" t-esc="activity.time"/>
                                        </div>
                                        <span t-attf-class="badge rounded-pill bg-{{activity.status === 'new' ? 'success' : (activity.status === 'pending' ? 'warning' : 'primary')}} bg-opacity-10 text-{{activity.status === 'new' ? 'success' : (activity.status === 'pending' ? 'warning' : 'primary')}} small px-3">
                                            <t t-esc="activity.status.toUpperCase()"/>
                                        </span>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Bottom spacing for aesthetic scroll -->
                <div style="height: 40px;"></div>
            </div>
        </div>
    </t>
</templates>
