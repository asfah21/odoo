<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="it_asset.DashboardMain">
        <div class="o_action_manager o_content o_it_asset_dashboard scroll-y">
            
            <!-- Standard Odoo-Style Control Panel -->
            <div class="control-panel shadow-sm">
                <div class="cp-left">
                    <div class="cp-title" t-esc="'IT Dashboard Overview'"/>
                </div>
                <div class="cp-right">
                    <!-- Category Filter -->
                    <div class="filter-group">
                        <label><i class="fa fa-tag"></i>Category</label>
                        <select class="category-select" t-on-change="onFilterCategory">
                            <option value="">All Categories</option>
                            <t t-foreach="categories" t-as="cat" t-key="cat.id">
                                <option t-att-value="cat.id" t-att-selected="selectedCategory === cat.id">
                                    <t t-esc="cat.name"/>
                                </option>
                            </t>
                        </select>
                    </div>
                    
                    <!-- Date Filters -->
                    <div class="filter-group">
                        <label><i class="fa fa-calendar-check-o"></i>From</label>
                        <input type="date" t-on-change="(ev) => this.onDateChange('start', ev)" t-att-value="dateStart"/>
                    </div>
                    <div class="filter-group">
                        <label><i class="fa fa-calendar-times-o"></i>To</label>
                        <input type="date" t-on-change="(ev) => this.onDateChange('end', ev)" t-att-value="dateEnd"/>
                    </div>
                </div>
            </div>

            <div class="dashboard-content">
                
                <!-- Summary Section -->
                <div class="section-header">INVENTORY STATUS</div>
                <div class="row g-3 mb-4">
                    <!-- Total Assets -->
                    <div class="col-6 col-md-4 col-xl">
                        <div class="modern-card card-purple" t-on-click="() => this.openView('all')">
                            <div class="card-body">
                                <div class="icon-circle shadow-sm"><i class="fa fa-laptop"></i></div>
                                <div class="stat-label">Total Assets</div>
                                <div class="stat-value" t-esc="stats.total_assets"/>
                            </div>
                        </div>
                    </div>
                    <!-- Available -->
                    <div class="col-6 col-md-4 col-xl">
                        <div class="modern-card card-green" t-on-click="() => this.openView('available')">
                            <div class="card-body">
                                <div class="icon-circle shadow-sm"><i class="fa fa-check-circle"></i></div>
                                <div class="stat-label">Available</div>
                                <div class="stat-value" t-esc="stats.available"/>
                            </div>
                        </div>
                    </div>
                    <!-- Assigned -->
                    <div class="col-6 col-md-4 col-xl">
                        <div class="modern-card card-blue" t-on-click="() => this.openView('assigned')">
                            <div class="card-body">
                                <div class="icon-circle shadow-sm"><i class="fa fa-user"></i></div>
                                <div class="stat-label">Assigned</div>
                                <div class="stat-value" t-esc="stats.assigned"/>
                            </div>
                        </div>
                    </div>
                    <!-- Unavailable -->
                    <div class="col-6 col-md-4 col-xl">
                        <div class="modern-card card-red" t-on-click="() => this.openView('unavailable')">
                            <div class="card-body">
                                <div class="icon-circle shadow-sm"><i class="fa fa-ban text-danger"></i></div>
                                <div class="stat-label">Unavailable</div>
                                <div class="stat-value" t-esc="stats.unavailable_broken"/>
                            </div>
                        </div>
                    </div>
                    <!-- Maintenance -->
                    <div class="col-6 col-md-4 col-xl">
                        <div class="modern-card card-amber" t-on-click="() => this.openView('maintenance_logs')">
                            <div class="card-body">
                                <div class="icon-circle shadow-sm"><i class="fa fa-wrench"></i></div>
                                <div class="stat-label">Maintenance</div>
                                <div class="stat-value" t-esc="stats.maintenance_count"/>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row g-4 mb-4">
                    <!-- Distribution Chart -->
                    <div class="col-12 col-lg-5 col-xl-4">
                        <div class="chart-panel shadow-sm">
                            <h4 class="mb-4">Status Map</h4>
                            <div class="donut-wrapper mb-4 shadow-sm" 
                                 t-attf-style="background: conic-gradient(
                                    #16a34a 0% {{ (stats.available / (stats.total_assets or 1)) * 100 }}%, 
                                    #0284c7 {{ (stats.available / (stats.total_assets or 1)) * 100 }}% {{ ((stats.available + stats.assigned) / (stats.total_assets or 1)) * 100 }}%, 
                                    #ef4444 {{ ((stats.available + stats.assigned) / (stats.total_assets or 1)) * 100 }}% 100%
                                 );">
                                <div class="donut-hole shadow-inner">
                                    <span class="hole-value" t-esc="stats.total_assets"/>
                                    <span class="hole-label">Total</span>
                                </div>
                            </div>
                            <!-- Legend -->
                                <div class="d-flex align-items-center justify-content-between small fw-bold">
                                    <span class="text-muted"><i class="fa fa-circle me-2 text-success"></i>Available</span>
                                    <span t-esc="stats.available"/>
                                </div>
                                <div class="d-flex align-items-center justify-content-between small fw-bold">
                                    <span class="text-muted"><i class="fa fa-circle me-2 text-primary"></i>Assigned</span>
                                    <span t-esc="stats.assigned"/>
                                </div>
                                <div class="d-flex align-items-center justify-content-between small fw-bold">
                                    <span class="text-muted"><i class="fa fa-circle me-2 text-danger"></i>Unavailable</span>
                                    <span t-esc="stats.unavailable_broken"/>
                                </div>
                        </div>
                    </div>

                    <!-- Category Bar Chart -->
                    <div class="col-12 col-lg-4 col-xl-5">
                        <div class="chart-panel shadow-sm">
                            <h4 class="mb-4">Top Asset Categories</h4>
                            <div class="category-list">
                                <t t-foreach="stats.category_distribution" t-as="cat_data" t-key="cat_data.name">
                                    <div class="category-bar-row">
                                        <div class="bar-info">
                                            <span t-esc="cat_data.name"/>
                                            <span class="text-primary" t-esc="cat_data.count"/>
                                        </div>
                                        <div class="bar-track">
                                            <div class="bar-progress" 
                                                 t-attf-style="width: {{ (cat_data.count / (stats.total_assets or 1)) * 100 }}%"/>
                                        </div>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>

                    <!-- Laptop Condition Column Chart -->
                    <div class="col-12 col-lg-3 col-xl-3">
                        <div class="chart-panel shadow-sm">
                            <h4 class="mb-4">Laptop Condition</h4>
                            <div class="d-flex align-items-end justify-content-around h-75 mt-4">
                                <t t-foreach="stats.laptop_condition_distribution" t-as="cond" t-key="cond.label">
                                    <div class="d-flex flex-column align-items-center flex-grow-1">
                                        <div class="fw-bold mb-2 small" t-esc="cond.count"/>
                                        <div class="column-bar shadow-sm"
                                             t-attf-style="height: {{ cond.perc }}px; background-color: {{ cond.color }}; width: 30px; border-radius: 4px 4px 0 0; transition: height 1s ease-out;"/>
                                        <div class="mt-2 small text-muted text-center" style="font-size: 0.65rem;" t-esc="cond.label"/>
                                    </div>
                                </t>
                            </div>
                            <t t-if="!stats.laptop_condition_distribution.length">
                                <div class="text-center py-4">
                                    <span class="small text-muted">No Laptop found</span>
                                </div>
                            </t>
                        </div>
                    </div>
                </div>

                <!-- Footer Stats (Support & Recent) -->
                <div class="row g-4">
                    <div class="col-12 col-md-6">
                        <div class="chart-panel shadow-sm">
                            <h4 class="mb-3">Global Service Stats (Upcoming)</h4>
                            <div class="row g-2">
                                <div class="col-6">
                                    <div class="p-3 bg-light rounded-3 border d-flex align-items-center">
                                        <div class="me-2 me-md-3 p-2 bg-white rounded shadow-sm d-none d-sm-block"><i class="fa fa-ticket text-primary"></i></div>
                                        <div>
                                            <div class="text-muted small fw-bold" style="font-size: 0.65rem;">ACTIVE TICKETS</div>
                                            <div class="h4 mb-0 fw-bold" t-esc="stats.tickets_open"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="p-3 bg-light rounded-3 border d-flex align-items-center">
                                        <div class="me-2 me-md-3 p-2 bg-white rounded shadow-sm d-none d-sm-block"><i class="fa fa-user-plus text-success"></i></div>
                                        <div>
                                            <div class="text-muted small fw-bold" style="font-size: 0.65rem;">ACCOUNTS REQ</div>
                                            <div class="h4 mb-0 fw-bold" t-esc="stats.account_requests_pending"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6">
                        <div class="chart-panel shadow-sm">
                            <h4 class="mb-3">Recent Operations</h4>
                            <div class="activity-log">
                                <t t-foreach="stats.recent_activities" t-as="activity" t-key="activity.id">
                                    <div class="log-entry">
                                        <div class="entry-icon shadow-sm">
                                            <i t-if="activity.type == 'ticket'" class="fa fa-ticket"></i>
                                            <i t-if="activity.type == 'request'" class="fa fa-user-plus"></i>
                                            <i t-if="activity.type == 'asset'" class="fa fa-laptop"></i>
                                        </div>
                                        <div class="flex-grow-1 overflow-hidden">
                                            <div class="fw-bold small text-truncate" t-esc="activity.title"/>
                                            <div class="text-muted text-truncate" style="font-size: 0.7rem;" t-esc="activity.time"/>
                                        </div>
                                        <span t-attf-class="badge rounded-pill bg-{{activity.status === 'new' ? 'success' : (activity.status === 'pending' ? 'warning' : 'primary')}} bg-opacity-10 text-{{activity.status === 'new' ? 'success' : (activity.status === 'pending' ? 'warning' : 'primary')}} small px-2 px-md-3">
                                            <t t-esc="activity.status.toUpperCase()"/>
                                        </span>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Bottom spacing for aesthetic scroll -->
                <div style="height: 40px;"></div>
            </div>
        </div>
    </t>
</templates>
